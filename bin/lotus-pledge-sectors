#!/usr/bin/env bash

## Courtesy of Patrick - Factor8 Solutions
## DO NOT USE ON MAINNET!!
## Modifications by me :)

if ! command -v lotus-miner &> /dev/null
then
    echo "Please install lotus-miner before continuing."
    exit
fi

# Metrics at a glance
# 2700 seconds = 45 minutes    (~1TiB/day)
# 1350 seconds = 22.5 minutes  (~2TiB/day)
# 900 seconds  = 15 minutes    (~3TiB/day)
# 675 seconds  = 11.25 minutes (~4TiB/day)
# 540 seconds  = 9 minutes     (~5TiB/day)
# 450 seconds  = 7.5 minutes   (~6TiB/day)
# 386 seconds  = 6.43 minutes  (~7TiB/day)
# 338 seconds  = 5.6 minutes   (~8TiB/day)
# 300 seconds  = 5 minutes     (~9TiB/day)
# 270 seconds  = 4.5 minutes  (~10TiB/day)
LOOP_SLEEP_TIME=540

INITIAL_SLEEP_TIME=0
PLEDGE_COUNTER=0
WITHDRAWL_INTERVAL=10

sleep $INITIAL_SLEEP_TIME

while [ $PLEDGE_COUNTER -le 320 ]
do
    lotus-miner sectors pledge
    let PLEDGE_COUNTER++
    if ! (( $PLEDGE_COUNTER % $WITHDRAWL_INTERVAL )) ; then
        lotus-miner actor withdraw &
    fi
    sleep $LOOP_SLEEP_TIME
done
exit 0

## DO NOT USE ON MAINNET!!
