#!/usr/bin/env bash

for w in "$HOME"/.lotusworkers/*
do
    declare name=$(basename $w)
    declare host=$(hostname)

    if [ ! -f "${w}/repo.lock" ] && [ -f "${w}/storage.json" ]; then
        declare time=$(date +"%Y-%m-%d %T")
        mail -s "$name on $host offline" -r bot@ops.sandford.pub team@ops.sandford.pub \
            <<< "$time --- $name on $host is offline. If this worker was previously online, begin troubleshooting ASAP. End report."
    fi
done